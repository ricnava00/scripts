(echo -n "[["; find -maxdepth ${1:-9999} -type f -not -path "./converted/*" \( -iname "*.mp4" -or -iname "*.m4v" -or -iname "*.wmv" -or -iname "*.mov" -or -iname "*.ts" -or -iname "*.mkv" -or -iname "*.webm" -or -iname "*.avi" -or -iname "*.mpg" -or -iname "*.3gp" -or -iname "*.flv" -or -iname "*.rmvb" \) | parallel -j200% -X mediainfo --Output=JSON {} | perl -0777 -pe 's/\}(\n\])?\n\n(\[\n)?\{/\},\n\{/g' | perl -0 -pe 's/\n+\Z//'; echo "]]") | perl -0777 -pe 's/\[{2,3}\n?\{/[{/' | perl -0777 -pe 's/\}\n?\]{2,3}/}]/'